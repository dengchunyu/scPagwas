<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Main wrapper functions for scPagwas — scPagwas_main • scPagwas</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Main wrapper functions for scPagwas — scPagwas_main"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scPagwas</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Conventional%20Parameters%20and%20Usage%20Instructions%20with%20Demo%20Example%20Data.html">Conventional Parameters and Usage Instructions with Demo Example Data</a>
    <a class="dropdown-item" href="../articles/Conventional%20result%20and%20visualization%20Instructions%20with%20Real-World%20Examples.html">Conventional result and visualization Instructions with Real-World Examples</a>
    <a class="dropdown-item" href="../articles/Introduction%20to%20Data%20Input%20and%20Preprocessing%20in%20scPagwas.html">Introduction to Data Input and Preprocessing in scPagwas</a>
    <a class="dropdown-item" href="../articles/Perform%20calculations%20for%20multiple%20traits%20based%20on%20a%20single-cell%20dataset.html">Perform calculations for multiple traits based on a single-cell dataset</a>
    <a class="dropdown-item" href="../articles/Pruning%20Process%20for%20GWAS%20Summary%20Statistics%20File%20in%20scPagwas.html">Pruning Process for GWAS Summary Statistics File in scPagwas</a>
    <a class="dropdown-item" href="../articles/Strategies%20for%20Large-scale%20Single-cell%20Data%20Subsetting%20and%20Computation.html">Strategies for Large-scale Single-cell Data Subsetting and Computation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Main wrapper functions for scPagwas</h1>
      
      <div class="d-none name"><code>scPagwas_main.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">scPagwas_main</span><span class="op">(</span></span>
<span>  Pagwas <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gwas_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output.prefix <span class="op">=</span> <span class="st">"Test"</span>,</span>
<span>  output.dirs <span class="op">=</span> <span class="st">"scPagwastest_output"</span>,</span>
<span>  block_annotation <span class="op">=</span> <span class="va">block_annotation</span>,</span>
<span>  Single_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  assay <span class="op">=</span> <span class="st">"RNA"</span>,</span>
<span>  Pathway_list <span class="op">=</span> <span class="va">Genes_by_pathway_kegg</span>,</span>
<span>  chrom_ld <span class="op">=</span> <span class="va">chrom_ld</span>,</span>
<span>  run_split <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n.cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  marg <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  maf_filter <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  min_clustercells <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  min.pathway.size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  max.pathway.size <span class="op">=</span> <span class="fl">300</span>,</span>
<span>  iters_celltype <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  iters_singlecell <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_topgenes <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  singlecell <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  celltype <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seurat_return <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  remove_outlier <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>Pagwas</dt>
<dd><p>= NULL: This parameter is typically not required and does not need any input data. When seurat_return = FALSE, all intermediate data is stored in the "Pagwas" list and returned as the result. This result can be inherited and used as input for subsequent calculations. In certain scenarios, such as when performing two computations with the same single-cell data input but different GWAS data inputs, the result list obtained from the first computation can be used as the "Pagwas" parameter input for the second computation. This allows skipping the single-cell calculations, significantly expediting the process. However, when seurat_return = TRUE, the returned result cannot be manipulated in this manner, as it is the final Seurat result with many intermediate data removed.</p></dd>


<dt>gwas_data</dt>
<dd><p>(data.frame)GWAS summary data; It must have some
colmuns such as:
chrom|    pos    |   rsid    |   se  |  beta |  maf
6 | 119968580 | rs1159767 | 0.032 | 0.019 |0.5275
10 | 130566523 |  rs559109 | 0.033 | 0.045 |0.4047
5 | 133328825 | rs6893145 | 0.048 | 0.144 |0.1222
7 | 146652932 | rs13228798| 0.035 | 0.003 | 0.3211</p></dd>


<dt>output.prefix</dt>
<dd><p>= "Test": This parameter sets the prefix for the output result files.</p></dd>


<dt>output.dirs</dt>
<dd><p>= "scPagwastest_output": This parameter specifies the directory for the output result files.</p></dd>


<dt>block_annotation</dt>
<dd><p>(data.frame) Start and end points for block
traits, usually genes.</p></dd>


<dt>Single_data</dt>
<dd><p>(character or seurat)Input the Single data in seurat
format, or the seurat data address for rds format.Idents should be the celltypes annotation.</p></dd>


<dt>assay</dt>
<dd><p>(character)assay data of your single cell data to use,
default is "RNA"</p></dd>


<dt>Pathway_list</dt>
<dd><p>(list,character) pathway gene sets list</p></dd>


<dt>chrom_ld</dt>
<dd><p>(list,numeric)LD data for 22 chromosome.</p></dd>


<dt>run_split</dt>
<dd><p>(logical) Whether the input single cell data is a split sub-data, if TRUE,
one result(gPas score) is return, if FALSE, the whole function is running. default is FALSE.</p></dd>


<dt>n.cores</dt>
<dd><p>cores for regression</p></dd>


<dt>marg</dt>
<dd><p>(integr) the distance to TSS site,default is 10000, then
gene-TSS-window size is 20000.</p></dd>


<dt>maf_filter</dt>
<dd><p>(numeric)Filter the maf, default is 0.01</p></dd>


<dt>min_clustercells</dt>
<dd><p>(integr)Only use is when FilterSingleCell is
TRUE.Threshold for total cells fo each cluster.default is 10</p></dd>


<dt>min.pathway.size</dt>
<dd><p>(integr)Threshold for min pathway gene size.
default is 5</p></dd>


<dt>max.pathway.size</dt>
<dd><p>(integr)Threshold for max pathway gene size.
default is 300</p></dd>


<dt>iters_celltype</dt>
<dd><p>(integr)number of bootstrap iterations for celltype</p></dd>


<dt>iters_singlecell</dt>
<dd><p>(integr)number of bootstrap iterations for singlecell；
The parameter "iters_singlecell" is used to calculate the significance p-value for individual cells. However, we have observed that this step requires a significant amount of computational memory. Therefore, we do not recommend selecting a large value for this parameter initially.If you do not want to waste time calculating the p-value, you can choose to set it as 0.</p></dd>


<dt>n_topgenes</dt>
<dd><p>(integr)Number of top associated gene selected to
calculate the scPagwas score;</p></dd>


<dt>singlecell</dt>
<dd><p>(logical)Whether to produce the singlecell result;</p></dd>


<dt>celltype</dt>
<dd><p>(logical)Whether to produce the celltypes result;</p></dd>


<dt>seurat_return</dt>
<dd><p>(logical) Whether return the seurat format result,
if not,will return a list result;</p></dd>


<dt>remove_outlier</dt>
<dd><p>(logical)Whether to remove the outlier for
scPagwas score.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns a seurat data with entries(seurat_return=T):</p><dl><dt>assay:</dt>
<dd><p>scPagwasPaPca:An assay for S4 type of data; the svd result
for pathways in each cells;
scPagwasPaHeritability:An assay for S4 type of data; the
gPas matrix for pathways in each cells;</p></dd>

<dt>meta.data</dt>
<dd><p>scPagwas.TRS.Score1: the column for "meta.data";Enrichment socre
for inheritance associated top genes.
scPagwas.gPAS.score: the column for "meta.data";Inheritance
regression effects for each cells
Random_Correct_BG_p: CellpValue for each cells;
Random_Correct_BG_adjp: fdr for each cells, adjust p value.
Random_Correct_BG_z: z score for eahc cells.
misc: element in result,<code>Pagwas@misc </code>
Pathway_list:a list for pathway gene list intersecting with single
cell data
pca_cell_df: a data frame for pathway pca result for each celltype.
lm_results: the regression result for each cell.
PCC:
heritability correlation value for each gene;In the previous version, we referred to it as Pearson correlation coefficients.
bootstrap_results:The bootstrap data frame results for celltypes
including bootstrap pvalue and confidence interval.</p></dd>

Returns files:


scPagwas.run.log: the running log file for scPagwas
<em>_parameters.txt:</em>parameters log file for scPagwas
_pca_scCell_mat.txt: 1st svd result for pathways in each cell
<em>_pca_celltypes_mat.txt:</em> 1st svd results for pathways in celltypes
_singlecell_scPagwas_score.Result.csv: The final result for
lm and top gene score
<em>_celltypes_bootstrap_results.csv:</em>The bootstrap data frame
results for celltypes including bootstrap pvalue and confidence
interval
_gene_PCC.csv: heritability correlation
value("cor" for pearson) for each gene;


Returns a list class with entries(seurat_return=F):

scPagwasPaPca:Assays for S4 type of data; the svd result for
pathways in each cells;
scPagwas.topgenes.Score1: the column for "meta.data";
Enrichment socre for inheritance associated top genes.
sclm_score: the column for "meta.data";Inheritance regression
effects for each cells
Pathway_list: The number of Lanczos iterations carried out
pca_cell_df: The total number of matrix vector products carried out
sclm_results: The total number of matrix vector products carried out
PCC: The total number of
matrix vector products carried out;In the previous version, we referred to it as Pearson correlation coefficients
Pathway_ctlm_results: The total number of matrix vector products
carried out
lm_results: The total number of matrix vector products carried out
Pathway_ct_results: The total number of matrix vector products
carried out


</dl><p>Main Pagwas wrapper functions.</p>


<p>scPagwas, A single-cell pathway-based principal component (PC)-scoring
algorithm named for integrating polygenic signals from GWAS with
single cell data to infer disease-relevant cell populations and score
the associations of individual cells with complex diseases.The entry point for Pagwas analysis.
Including the data input functions and the main progress functions;
It can also output the
running log and parameter log for scPagwas, and construct the folder
for output.</p>


<p>1.When you run the package in linux server, you can run
<code>export OPENBLAS_NUM_THREADS=1</code>
before enter into R environment, It can help you to avoid core errors.
2. When the code is kill for some wrong, you can run
<code><a href="https://rdrr.io/pkg/SOAR/man/Objects.html" class="external-link">SOAR::Objects()</a></code> to check the objects, or
run <code>SOAR::Remove(SOAR::Objects())</code> to remove it.
3. When your data is too big to run the function(bus error), you can
split your data into several sub-data and run the merge_pagwas
to merge them.</p>


<p>library(scPagwas)
Pagwas_data &lt;- scPagwas_main(
  Pagwas = NULL,
  gwas_data = system.file("extdata", "GWAS_summ_example.txt",
    package = "scPagwas"
  ),
  Single_data = system.file("extdata", "scRNAexample.rds",
    package = "scPagwas"
  ),
  output.prefix = "test",
  output.dirs = "scPagwastest_output",
  block_annotation = block_annotation,
  assay = "RNA",
  Pathway_list = Genes_by_pathway_kegg,
  chrom_ld = chrom_ld,
  singlecell = TRUE,
  celltype = TRUE)</p>


<p>Polygenic regression identifies trait-relevant cell subpopulations
through pathway activity transformed single-cell RNA sequencing data.(2022)</p>


<p>Chunyu Deng</p>


<p>functions.</p>


<p>of</p>


<p>scPagwas</p>


<p>scPagwas_main,</p>


<p>wrapper</p>


    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Chunyu Deng.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

