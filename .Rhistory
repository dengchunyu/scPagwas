theme (axis.text.x = element_text (angle = 35, hjust = 1))
library(dplyr)
library(ggplot2)
library(patchwork)
library(ggpubr)
DotPlot(scdata,features=unique(degenes),group.by="seurat_clusters",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
coord_flip()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))
scdata$annot<-scdata$seurat_clusters
scdata$annot[scdata$annot=="4"]<-"CMZ_LIKE_4"
scdata$annot=="4"
scdata$annot<-as.character(scdata$annot)
scdata$annot<-scdata$seurat_clusters
scdata$annot<-as.character(scdata$annot)
scdata$annot[scdata$annot=="4"]<-"CMZ_LIKE_4"
pdf("D:\\OneDrive\\类器官空间\\DEanalysis\\dotplot_CMZ_degenes_forspatialcluster.pdf",width = 6,height = 15)
DotPlot(scdata,features=unique(degenes),group.by="annot",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
coord_flip()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))
dev.off()
length(degenes)
length(=unique(degenes))
length(unique(degenes))
read.csv("D:\\OneDrive\\类器官空间\\DEanalysis\\1.All_cluster_up_marker.csv",header = T)->spatial_de_gene
head(spatial_de_gene)
colnames(spatial_de_gene)
head(spatial_de_gene$gene)
intersect(spatial_de_gene$gene,degenes)->degenes
degenes
length(degenes)/70->n
n
n<-ceiling(n)
n
length(degenes)/50->n
n<-ceiling(n)
n
for (i in 1:n){
sub_genes<-degenes[((i-1)*50+1):min(i*50,length(degenes))]
pdf(paste0("D:\\OneDrive\\类器官空间\\DEanalysis\\dotplot_CMZ_degenes_forspatialcluster_sub",i,".pdf"),width = 6,height = 15)
DotPlot(scdata,features=sub_genes,group.by="annot",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
coord_flip()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))
dev.off()
}
for (i in 1:n){
sub_genes<-degenes[((i-1)*50+1):min(i*50,length(degenes))]
p<-DotPlot(scdata,features=sub_genes,group.by="annot",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
coord_flip()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))
pdf(paste0("D:\\OneDrive\\类器官空间\\DEanalysis\\dotplot_CMZ_degenes_forspatialcluster_sub",i,".pdf"),width = 6,height = 15)
print(p)
dev.off()
}
length(degenes)
read.csv("D:\\OneDrive\\类器官空间\\DEanalysis\\chenming_check_8.4.csv",header = T)->chenming_check
chenming_check
read.csv("D:\\OneDrive\\类器官空间\\DEanalysis\\chenming_check_8.4.csv",header = T)->chenming_check
chenming_check
scdata$New_celltype
read.delim("D:\\OneDrive\\类器官空间\\H9_D60_decon_mtrx.txt",header = T,sep="\t")->decon_mtrx
meta.data<-scdata@meta.data
cell_id<-intersect(rownames(meta.data),rownames(decon_mtrx))
decon_mtrx[cell_id,"cluster"]<-meta.data[cell_id,"seurat_clusters"]
na.omit(decon_mtrx)->decon_mtrx
#计算每个cluster,每一列细胞类型的平均比例
mean_list<-list()
for (i in 1:6){
cluster<-i-1
decon_mtrx[decon_mtrx$cluster==cluster,1:(ncol(decon_mtrx)-1)]->sub_decon_mtrx
colMeans(sub_decon_mtrx)->sub_decon_mtrx_mean
mean_list[[i]]<-sub_decon_mtrx_mean
}
as.data.frame(do.call(rbind,mean_list))->mean_df
rownames(mean_df)<-paste0("cluster",0:5)
#保存
write.csv(mean_df,"D:\\OneDrive\\类器官空间\\DEanalysis\\spatial_cluster_decon_mtrx_mean.csv",row.names = T)
#得到top2比例的细胞类型
top2_celltype<-list()
for (i in 1:6){
mean_list[[i]]->sub_mean
names(sort(sub_mean,decreasing = T)[1:3])->a
paste(a,collapse = "_")->top2_celltype[[i]]
}
cell_names<-unlist(top2_celltype)
scdata$New_celltype<-scdata$seurat_clusters
scdata$New_celltype<-as.character(scdata$New_celltype)
for (i in 1:6){
cell_names[i]->cell_name
scdata$New_celltype[scdata$New_celltype==i-1]<-cell_name
}
#level
scdata$New_celltype<-factor(scdata$New_celltype,levels = cell_names)
scdata$New_celltype
scdata$seurat_clusters[scdata$seurat_clusters==0]<-6
scdata$seurat_cluster
scdata
scdata$seurat_clusters
scdata$seurat_clusters<-as.numeric(scdata$seurat_clusters)
scdata$seurat_clusters[is.na(scdata$seurat_clusters)]<-6
scdata$seurat_clusters
scdata$New_celltype2 <- paste(scdata$New_celltype,scdata$seurat_clusters,sep="_")
cell_names
cell_names<-paste(cell_names,c(6,1:5),sep="_")
cell_names
cell_names[c(2:6,1)]
scdata$New_celltype2<-factor(scdata$New_celltype2,levels = cell_names[c(2:6,1)])
GENES<-intersect(chenming_check$GENES,rownames(scdata))
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
unique(GENES),
GENES
scdata$New_celltype2
scdata$New_celltypescdata$New_celltypescdata$New_celltype
scdata$New_celltype
scdata$seurat_clusters
scdata$New_celltype2 <- paste(scdata$New_celltype,scdata$seurat_clusters,sep="_")
unique(scdata$New_celltype2)
scdata<-readRDS("D:\\OneDrive\\类器官空间\\DEanalysis\\H9_D60_2_stdata.rds")
scdata<-subset(scdata,subset = seurat_clusters!=6 & seurat_clusters!=7)
scdata
read.csv("D:\\OneDrive\\类器官空间\\DEanalysis\\chenming_check_8.4.csv",header = T)->chenming_check
scdata$seurat_clusters<-as.numeric(scdata$seurat_clusters)
scdata$seurat_clusters==0
scdata$seurat_clusters[scdata$seurat_clusters==0]<-6
unique(scdata$seurat_clusters)
scdata$New_celltype2 <- paste(scdata$New_celltype,scdata$seurat_clusters,sep="_")
read.delim("D:\\OneDrive\\类器官空间\\H9_D60_decon_mtrx.txt",header = T,sep="\t")->decon_mtrx
meta.data<-scdata@meta.data
cell_id<-intersect(rownames(meta.data),rownames(decon_mtrx))
decon_mtrx[cell_id,"cluster"]<-meta.data[cell_id,"seurat_clusters"]
na.omit(decon_mtrx)->decon_mtrx
mean_list<-list()
for (i in 1:6){
cluster<-i-1
decon_mtrx[decon_mtrx$cluster==cluster,1:(ncol(decon_mtrx)-1)]->sub_decon_mtrx
colMeans(sub_decon_mtrx)->sub_decon_mtrx_mean
mean_list[[i]]<-sub_decon_mtrx_mean
}
as.data.frame(do.call(rbind,mean_list))->mean_df
rownames(mean_df)<-paste0("cluster",0:5)
#保存
write.csv(mean_df,"D:\\OneDrive\\类器官空间\\DEanalysis\\spatial_cluster_decon_mtrx_mean.csv",row.names = T)
#得到top2比例的细胞类型
top2_celltype<-list()
for (i in 1:6){
mean_list[[i]]->sub_mean
names(sort(sub_mean,decreasing = T)[1:3])->a
paste(a,collapse = "_")->top2_celltype[[i]]
}
cell_names<-unlist(top2_celltype)
scdata$New_celltype<-scdata$seurat_clusters
scdata$New_celltype<-as.character(scdata$New_celltype)
for (i in 1:6){
cell_names[i]->cell_name
scdata$New_celltype[scdata$New_celltype==i-1]<-cell_name
}
scdata$New_celltype<-factor(scdata$New_celltype,levels = cell_names)
unique(scdata$seurat_clusters)
scdata$New_celltype2 <- paste(scdata$New_celltype,scdata$seurat_clusters,sep="_")
unique(scdata$New_celltype2
)
scdata$New_celltype
scdata<-readRDS("D:\\OneDrive\\类器官空间\\DEanalysis\\H9_D60_2_stdata.rds")
scdata<-subset(scdata,subset = seurat_clusters!=6 & seurat_clusters!=7)
read.delim("D:\\OneDrive\\类器官空间\\H9_D60_decon_mtrx.txt",header = T,sep="\t")->decon_mtrx
meta.data<-scdata@meta.data
cell_id<-intersect(rownames(meta.data),rownames(decon_mtrx))
decon_mtrx[cell_id,"cluster"]<-meta.data[cell_id,"seurat_clusters"]
na.omit(decon_mtrx)->decon_mtrx
#计算每个cluster,每一列细胞类型的平均比例
mean_list<-list()
for (i in 1:6){
cluster<-i-1
decon_mtrx[decon_mtrx$cluster==cluster,1:(ncol(decon_mtrx)-1)]->sub_decon_mtrx
colMeans(sub_decon_mtrx)->sub_decon_mtrx_mean
mean_list[[i]]<-sub_decon_mtrx_mean
}
as.data.frame(do.call(rbind,mean_list))->mean_df
rownames(mean_df)<-paste0("cluster",0:5)
read.delim("D:\\OneDrive\\类器官空间\\H9_D60_decon_mtrx.txt",header = T,sep="\t")->decon_mtrx
meta.data<-scdata@meta.data
cell_id<-intersect(rownames(meta.data),rownames(decon_mtrx))
decon_mtrx[cell_id,"cluster"]<-meta.data[cell_id,"seurat_clusters"]
na.omit(decon_mtrx)->decon_mtrx
#计算每个cluster,每一列细胞类型的平均比例
mean_list<-list()
for (i in 1:6){
cluster<-i-1
decon_mtrx[decon_mtrx$cluster==cluster,1:(ncol(decon_mtrx)-1)]->sub_decon_mtrx
colMeans(sub_decon_mtrx)->sub_decon_mtrx_mean
mean_list[[i]]<-sub_decon_mtrx_mean
}
as.data.frame(do.call(rbind,mean_list))->mean_df
rownames(mean_df)<-paste0("cluster",0:5)
top2_celltype<-list()
for (i in 1:6){
mean_list[[i]]->sub_mean
names(sort(sub_mean,decreasing = T)[1:3])->a
paste(a,collapse = "_")->top2_celltype[[i]]
}
cell_names<-unlist(top2_celltype)
scdata$New_celltype<-scdata$seurat_clusters
scdata$New_celltype<-as.character(scdata$New_celltype)
for (i in 1:6){
cell_names[i]->cell_name
scdata$New_celltype[scdata$New_celltype==i-1]<-cell_name
}
#level
scdata$New_celltype<-factor(scdata$New_celltype,levels = cell_names)
unique(scdata$New_celltype)
scdata$New_celltype
read.csv("D:\\OneDrive\\类器官空间\\DEanalysis\\chenming_check_8.4.csv",header = T)->chenming_check
#将scdata$seurat_clusters中的0改为6
scdata$seurat_clusters<-as.numeric(scdata$seurat_clusters)
scdata$seurat_clusters[scdata$seurat_clusters==0]<-6
scdata$seurat_clusters
cell_names
scdata$New_celltype2 <- paste(scdata$New_celltype,scdata$seurat_clusters,sep="_")
unique(scdata$New_celltype2)
scdata$New_celltype2<-factor(scdata$New_celltype2,levels = cell_names)
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
scdata$New_celltype2
cell_names
cell_names
cell_names<-paste(cell_names,1:6,sep="_")
scdata$New_celltype2 <- paste(scdata$New_celltype,scdata$seurat_clusters,sep="_")
cell_names
unique(scdata$New_celltype2)
scdata$New_celltype2<-factor(scdata$New_celltype2,levels = cell_names)
scdata$New_celltype2
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
scdata<-readRDS("D:\\OneDrive\\类器官空间\\DEanalysis\\H9_D60_2_stdata.rds")
scdata<-subset(scdata,subset = seurat_clusters!=6 & seurat_clusters!=7)
read.delim("D:\\OneDrive\\类器官空间\\H9_D60_decon_mtrx.txt",header = T,sep="\t")->decon_mtrx
meta.data<-scdata@meta.data
cell_id<-intersect(rownames(meta.data),rownames(decon_mtrx))
decon_mtrx[cell_id,"cluster"]<-meta.data[cell_id,"seurat_clusters"]
na.omit(decon_mtrx)->decon_mtrx
#计算每个cluster,每一列细胞类型的平均比例
mean_list<-list()
for (i in 1:6){
cluster<-i-1
decon_mtrx[decon_mtrx$cluster==cluster,1:(ncol(decon_mtrx)-1)]->sub_decon_mtrx
colMeans(sub_decon_mtrx)->sub_decon_mtrx_mean
mean_list[[i]]<-sub_decon_mtrx_mean
}
as.data.frame(do.call(rbind,mean_list))->mean_df
rownames(mean_df)<-paste0("cluster",0:5)
mean_df
top2_celltype<-list()
for (i in 1:6){
mean_list[[i]]->sub_mean
names(sort(sub_mean,decreasing = T)[1:3])->a
paste(a,collapse = "_")->top2_celltype[[i]]
}
top2_celltype
cell_names<-unlist(top2_celltype)
cell_names
scdata$New_celltype<-scdata$seurat_clusters
scdata$New_celltype<-as.numeric(scdata$seurat_clusters)
scdata$New_celltype
scdata<-readRDS("D:\\OneDrive\\类器官空间\\DEanalysis\\H9_D60_2_stdata.rds")
table(scdata$seurat_clusters)
scdata<-subset(scdata,subset = seurat_clusters!=6 & seurat_clusters!=7)
table(scdata$seurat_clusters)
scdata$New_celltype<-as.numeric(scdata$seurat_clusters)
table(scdata$New_celltype)
scdata$New_celltype<-as.character(scdata$seurat_clusters)
table(scdata$New_celltype)
cell_names
for (i in 1:6){
scdata$New_celltype[scdata$New_celltype==as.character(i-1)]<-top2_celltype[[i]]}
table(scdata$New_celltype)
scdata$seurat_clusters<-as.character(scdata$seurat_clusters)
scdata$seurat_clusters==0
table(scdata$seurat_clusters)
scdata$seurat_clusters[scdata$seurat_clusters==0]<-6
table(scdata$seurat_clusters)
scdata$New_celltype2 <- paste(scdata$New_celltype,scdata$seurat_clusters,sep="_")
cell_names<-paste(cell_names,c(6,1:5),sep="_")
cell_names
table(scdata$New_celltype2)
scdata$New_celltype2<-factor(scdata$New_celltype2,levels = cell_names)
scdata$New_celltype2
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
scdata$New_celltype2<-factor(scdata$New_celltype2,levels = cell_names[2:6,1])
cell_names
scdata$New_celltype2<-factor(scdata$New_celltype2,levels = cell_names[c(2:6,1)])
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
scdata$New_celltype2<-factor(scdata$New_celltype2,levels = rev(cell_names[c(2:6,1)]))
DotPlot(scdata,features=rev(unique(GENES)),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
scdata$seurat_clusters<-as.character(scdata$seurat_clusters)
table(scdata$seurat_clusters)
scdata$New_celltype<-scdata$seurat_clusters
scdata$New_celltype[scdata$New_celltype=="6"]<-"RPC_PCs"
scdata$New_celltype[scdata$New_celltype=="1"]<-"RGC"
scdata$New_celltype[scdata$New_celltype=="2"]<-"RPC_PC_precursors_MC"
scdata$New_celltype[scdata$New_celltype=="3"]<-"RPE_RPE_progenitors"
scdata$New_celltype[scdata$New_celltype=="4"]<-"hRSLCs"
scdata$New_celltype[scdata$New_celltype=="5"]<-"RPC_AC/HC_PC_MC"
scdata$New_celltype2 <- paste(scdata$New_celltype,scdata$seurat_clusters,sep="_")
table(scdata$New_celltype2)
cell_names<-c("RGC","RPC_PC_precursors_MC","RPE_RPE_progenitors","hRSLCs","RPC_AC/HC_PC_MC","RPC_PCs")
cell_names<-paste(cell_names,1:6,sep="_")
scdata$New_celltype2<-factor(scdata$New_celltype2,levels = rev(cell_names))
scdata$New_celltype2
GENES<-intersect(chenming_check$GENES,rownames(scdata))
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
pdf("D:\\OneDrive\\类器官空间\\DEanalysis\\celltypemarker_chenming8.4check_dotplot.pdf",width = 13,height = 4)
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 35, hjust = 1))+theme(legend.position = "top")
dev.off()
pdf("D:\\OneDrive\\类器官空间\\DEanalysis\\celltypemarker_chenming8.4check_dotplot.pdf",width = 14,height = 4)
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 45, hjust = 1))+theme(legend.position = "top")
dev.off()
scdata$New_celltype<-scdata$seurat_clusters
table(scdata$New_celltype)
read.csv("D:\\OneDrive\\类器官空间\\DEanalysis\\chenming_check_8.4.csv",header = T)->chenming_check
read.csv("D:\\OneDrive\\类器官空间\\DEanalysis\\chenming_check_8.4.csv",header = T)->chenming_check
scdata$New_celltype[scdata$New_celltype=="6"]<-"RPC/PC"
scdata$New_celltype[scdata$New_celltype=="1"]<-"RGC/RPC"
scdata$New_celltype[scdata$New_celltype=="2"]<-"RPC/PC_precursors/MC"
scdata$New_celltype[scdata$New_celltype=="3"]<-"RPE/RPE_progenitors"
scdata$New_celltype[scdata$New_celltype=="4"]<-"hRSLCs"
scdata$New_celltype[scdata$New_celltype=="5"]<-"RPC/PC/AC_HC/BC/MC"
cell_names<-c("RGC/RPC","RPC/PC_precursors/MC","RPE/RPE_progenitors","hRSLCs","RPC/PC/AC_HC/BC/MC","RPC/PC")
#cell_names<-paste(cell_names,1:6,sep="_")
scdata$New_celltype<-factor(scdata$New_celltype,levels = rev(cell_names))
GENES<-intersect(chenming_check$GENES,rownames(scdata))
DotPlot(scdata,features=unique(GENES),group.by="New_celltype2",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 45, hjust = 1))+theme(legend.position = "top")
DotPlot(scdata,features=unique(GENES),group.by="New_celltype",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 45, hjust = 1))+theme(legend.position = "top")
pdf("D:\\OneDrive\\类器官空间\\DEanalysis\\celltypemarker_chenming8.4check_dotplot.pdf",width = 14,height = 4)
DotPlot(scdata,features=unique(GENES),group.by="New_celltype",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 45, hjust = 1))+theme(legend.position = "top")
dev.off()
read.csv("D:\\OneDrive\\类器官空间\\DEanalysis\\chenming_check_8.4.csv",header = T)->chenming_check
GENES<-intersect(chenming_check$GENES,rownames(scdata))
DotPlot(scdata,features=unique(GENES),group.by="New_celltype",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 45, hjust = 1))+theme(legend.position = "top")
pdf("D:\\OneDrive\\类器官空间\\DEanalysis\\celltypemarker_chenming8.4check_dotplot.pdf",width = 14,height = 4)
DotPlot(scdata,features=unique(GENES),group.by="New_celltype",assay="SCT")+
scale_colour_gradient2(low="#3A71AA",mid="white",high="#B22028",midpoint=0)+
theme_bw()+
theme (axis.text.x = element_text (angle = 45, hjust = 1))+theme(legend.position = "top")
dev.off()
library(Seurat)
library(dplyr)
library(ggplot2)
library(patchwork)
library(ggpubr)
scdata<-readRDS("D:\\OneDrive\\类器官空间\\DEanalysis\\H9_D60_2_stdata.rds")
scdata<-subset(scdata,subset = seurat_clusters!=6 & seurat_clusters!=7)
scdata$seurat_clusters<-as.character(scdata$seurat_clusters)
scdata$seurat_clusters[scdata$seurat_clusters==0]<-6
scdata$New_celltype<-scdata$seurat_clusters
table(scdata$New_celltype)
scdata$New_celltype[scdata$New_celltype=="6"]<-"RPC/PC"
scdata$New_celltype[scdata$New_celltype=="1"]<-"RGC/RPC"
scdata$New_celltype[scdata$New_celltype=="2"]<-"RPC/PC_precursors/MC"
scdata$New_celltype[scdata$New_celltype=="3"]<-"RPE/RPE_progenitors"
scdata$New_celltype[scdata$New_celltype=="4"]<-"hRSLCs"
scdata$New_celltype[scdata$New_celltype=="5"]<-"RPC/PC/AC_HC/BC/MC"
saveRDS(scdata,"D:\\OneDrive\\类器官空间\\DEanalysis\\H9_D60_2_final_stdata.rds")
read.delim("D:\\OneDrive\\类器官空间\\H9_D60_decon_mtrx.txt",header = T,sep="\t")->decon_mtrx
meta.data<-scdata@meta.data
cell_id<-intersect(rownames(meta.data),rownames(decon_mtrx))
decon_mtrx[cell_id,"cluster"]<-meta.data[cell_id,"seurat_clusters"]
na.omit(decon_mtrx)->decon_mtrx
#计算每个cluster,每一列细胞类型的平均比例
mean_list<-list()
for (i in 1:6){
cluster<-i-1
decon_mtrx[decon_mtrx$cluster==cluster,1:(ncol(decon_mtrx)-1)]->sub_decon_mtrx
colMeans(sub_decon_mtrx)->sub_decon_mtrx_mean
mean_list[[i]]<-sub_decon_mtrx_mean
}
rownames(meta.data)
read.delim("D:\\OneDrive\\类器官空间\\H9_D60_decon_mtrx.txt",header = T,sep="\t")->decon_mtrx
meta.data<-scdata@meta.data
cell_id<-intersect(rownames(meta.data),rownames(decon_mtrx))
decon_mtrx[cell_id,"cluster"]<-meta.data[cell_id,"New_celltype"]
na.omit(decon_mtrx)->decon_mtrx
head(decon_mtrx)
mean_list<-list()
for (i in unique(decon_mtrx$cluster)){
decon_mtrx[decon_mtrx$cluster==i,1:(ncol(decon_mtrx)-1)]->sub_decon_mtrx
colMeans(sub_decon_mtrx)->sub_decon_mtrx_mean
mean_list[[i]]<-sub_decon_mtrx_mean
}
mean_list
as.data.frame(do.call(rbind,mean_list))->mean_df
rownames(mean_df)<-names(mean_list)
mean_list
mean_df
write.csv(mean_df,"D:\\OneDrive\\类器官空间\\DEanalysis\\spatial_cluster_decon_mtrx_mean.csv",row.names = T)
mean_df
data <- data.frame(
category = rownames(mean_df),
proportion = mean_df$BCs
)
data$ymax <- cumsum(data$proportion)
data$ymin <- c(0, head(data$ymax, n = -1))
ggplot(data, aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 3, fill = category)) +
geom_rect() +
coord_polar(theta = "y") +
xlim(c(2, 4)) +
theme_void() +
theme(legend.position = "bottom") +
labs(title = "Circle Donut Chart")
data
mean_df
data <- data.frame(
category = colnames(mean_df),
proportion = mean_df[1,]
)
colnames(mean_df)
mean_df[1,]
data <- data.frame(
category = colnames(mean_df),
proportion = unlist(mean_df[1,])
)
data
data$ymax <- cumsum(data$proportion)
data$ymin <- c(0, head(data$ymax, n = -1))
# 绘制圆环图
ggplot(data, aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 3, fill = category)) +
geom_rect() +
coord_polar(theta = "y") +
xlim(c(2, 4)) +
theme_void() +
theme(legend.position = "bottom") +
labs(title = "Circle Donut Chart")
max_proportion <- max(data$proportion)
max_category <- data$category[data$proportion == max_proportion]
p <- ggplot(data, aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 3, fill = category)) +
geom_rect() +
coord_polar(theta = "y") +
xlim(c(2, 4)) +
theme_void() +
theme(legend.position = "bottom") +
labs(title = "Circle Donut Chart")
# 添加黑色边框到最大比例的细胞类型
p + geom_rect(data = data[data$category == max_category, ],
aes(xmax = 4.1, xmin = 2.9, ymax = ymax, ymin = ymin),
color = "black", fill = NA)
p
max_category
ggplot(data, aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 3, fill = category)) +
geom_rect() +
coord_polar(theta = "y") +
xlim(c(2, 4)) +
theme_void() +
theme(legend.position = "bottom") +
labs(title = "Circle Donut Chart")
mean_df
ggplot(data, aes(ymax = ymax, ymin = ymin, xmax = 4, xmin = 3, fill = category)) +
geom_rect() +
coord_polar(theta = "y") +
xlim(c(2, 4)) +
theme_void() +
theme(legend.position = "bottom") +
labs(title = rownames(mean_df)[i])+
scale_fill_manual(values = c("#F8766D", "#00BA38", "#619CFF", "#F564E3", "#00BFC4", "#F9BF3B"))
getwd()
save.image("D:\\OneDrive\\类器官空间\\DEanalysis\\.RData")
