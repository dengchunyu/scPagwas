as_tibble()
para_mat <- para_mat %>%
group_by(celltypes) %>%
mutate(paras_sum_mean = (paras * nrow(scPathrankP)) / sum(paras))
para_mat <- para_mat %>%
group_by(path) %>%
mutate(specificity = (paras_sum_mean * nrow(scPathrankP)) / sum(paras_sum_mean)) %>%
ungroup()
d_spe <- para_mat %>% filter(paras_sum_mean > 1)
d_spe <- d_spe %>%
group_by(celltypes) %>%
top_n(., n_path_to_keep, specificity)
return(d_spe)
}
spe2 <- top_function(para_mat = scPathrankP,
n_path_to_keep = topn_path_celltype)
spe2 <- spe2[spe2$celltypes %in% celltypes, ]
spe <- unique(spe2$path)
scPathrankP <- scPathrankP[spe, celltypes]
proportion_df <- proportion_df[spe, celltypes]
proportion_df <- as.data.frame(proportion_df)
scPathrankP[scPathrankP > max_logp] <- max_logp
scPathrankP[scPathrankP < -log10(filter_p)] <- 0
proportion_df$pathways <- rownames(proportion_df)
scPathrankP$pathways <- rownames(scPathrankP)
gg_proportion <- reshape2::melt(proportion_df,
id.vars = "pathways",
variable.name = "celltypes",
value.name = "proportion")
gg_rankp <- reshape2::melt(scPathrankP,
id.vars = "pathways",
variable.name = "celltypes",
value.name = "CellqValue")
gg_dot <- merge(gg_rankp, gg_proportion)
p <- plot_scpathway_contri_dot(
data.to.plot = gg_dot,
display_max_sizes = F,
size_var = size_var,
col_var = col_var,
shape.scale = 8,
cols.use = cols.use,
dend_x_var = dend_x_var,
dist_method = dist_method,
hclust_method = hclust_method
)
gg_dot
head(proportion_df)
spe
spe2
scPathrankP
Pagwas@misc$scPathways_rankPvalue
Pagwas@misc$scPathways_rankPvalue
names(Pagwas@misc)
heritability_cor_scatterplot(gene_heri_cor=Pagwas@misc$gene_heritability_correlation,
topn_genes_label=10,
color_low="#035397",
color_high ="#F32424",
color_mid = "white",
text_size=2,
do_plot=T,
max.overlaps =20,
width = 7,
height = 7)
top5genes<-rownames(Pagwas@misc$gene_heritability_correlation)[order(Pagwas@misc$gene_heritability_correlation,decreasing = T)[1:5]]
plot_vln_Corgenes(seurat_obj=Pagwas,
assay="RNA", slot="data",
var_group="celltypes",
vec_features=top5genes,
vec_group_colors= color26,
do_plot = T
)
Bootstrap_P_Barplot(p_results=Pagwas@misc$bootstrap_results$bp_value[-1],
p_names=rownames(Pagwas@misc$bootstrap_results)[-1],
figurenames = "Bootstrap_P_Barplot.pdf",
width = 5,
height = 7,
do_plot=T,
title = "monocytecount_bmmc")
Bootstrap_estimate_Plot(Pagwas=Pagwas,
width = 9,
height = 7,
do_plot=T)
Pagwas$snp_gene_df <- SnpToGene(
gwas_data = Pagwas$gwas_data,
block_annotation = block_annotation,
marg = 10000
)
library(scPagwas)
Pagwas <- list()
Single_data <- readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
Pagwas <- Single_data_input(
Pagwas = Pagwas,
assay = "RNA",
Single_data = Single_data,
Pathway_list = Genes_by_pathway_kegg
)
Single_data <- Single_data[, colnames(Pagwas$data_mat)]
names(Pagwas)
Pagwas <- Pathway_pcascore_run(
Pagwas = Pagwas,
Pathway_list = Genes_by_pathway_kegg
)
names(Pagwas)
gwas_data <- bigreadr::fread2(system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"))
Pagwas <- GWAS_summary_input(
Pagwas = Pagwas,
gwas_data = gwas_data,
maf_filter = 0.1
)
names(Pagwas)
Pagwas$snp_gene_df <- SnpToGene(
gwas_data = Pagwas$gwas_data,
block_annotation = block_annotation,
marg = 10000
)
knitr::kable(head(Pagwas$snp_gene_df))
Pagwas <- Pathway_annotation_input(
Pagwas = Pagwas,
block_annotation = block_annotation
)
names(Pagwas)
Pagwas$pathway_blocks[1:3]
Pagwas <- Link_pathway_blocks_gwas(
Pagwas = Pagwas,
chrom_ld = chrom_ld,
singlecell = T,
celltype = T,
backingpath="./temp")
knitr::kable(Pagwas$Pathway_sclm_results[1:10,1:5])
Pagwas$lm_results <- Pagwas_perform_regression(Pathway_ld_gwas_data = Pagwas$Pathway_ld_gwas_data)
Pagwas <- Boot_evaluate(Pagwas, bootstrap_iters = 200, part = 0.5)
Pagwas$Pathway_ld_gwas_data <- NULL
names(Pagwas)
Pagwas$lm_results
knitr::kable(Pagwas$bootstrap_results)
Pagwas <- scPagwas_perform_score(
Pagwas = Pagwas,
remove_outlier = TRUE
)
names(Pagwas)
Pagwas$scPagwas.gPAS.score[1:10]
knitr::kable(head(Pagwas$scPathways_rankPvalue))
suppressMessages(require("RColorBrewer"))
suppressMessages(require("Seurat"))
suppressMessages(require("SeuratObject"))
suppressMessages(require("ggsci"))
suppressMessages(require("dplyr"))
suppressMessages(require("ggplot2"))
suppressMessages(require("ggpubr"))
Seurat::DimPlot(Pagwas,pt.size=1,reduction="umap",label = T, repel=TRUE)+
umap_theme()+ggtitle("Test")+labs(x="UMAP",y="")+theme(aspect.ratio=1)
Pagwas$gene_heritability_correlation <- scGet_gene_heritability_correlation(scPagwas.gPAS.score=Pagwas$scPagwas.gPAS.score,
data_mat=Pagwas$data_mat)
scPagwas_topgenes <- names(Pagwas$gene_heritability_correlation[order(Pagwas$gene_heritability_correlation, decreasing = T), ])[1:1000]
Single_data <- Seurat::AddModuleScore(Single_data, assay = "RNA", list(scPagwas_topgenes), name = c("scPagwas.TRS.Score"))
#run pvalue
CellScalepValue <- scGene_scaleP(
Single_mat = t(data.matrix(
Seurat::GetAssayData(Single_data, assay = 'RNA')[scPagwas_topgenes, ]
))
)
suppressMessages(require("RColorBrewer"))
suppressMessages(require("Seurat"))
suppressMessages(require("SeuratObject"))
suppressMessages(require("ggsci"))
suppressMessages(require("dplyr"))
suppressMessages(require("ggplot2"))
suppressMessages(require("ggpubr"))
Seurat::DimPlot(Pagwas,pt.size=1,reduction="umap",label = T, repel=TRUE)+
umap_theme()+ggtitle("Test")+labs(x="UMAP",y="")+theme(aspect.ratio=1)
scPagwas_Visualization(Single_data=Pagwas_singlecell,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "red",
output.dirs="figure",
size = 0.5,
do_plot = T)
library(scPagwas)
Pagwas<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
##------ Tue Mar 14 13:08:03 2023 ------##
##------ Tue Mar 14 13:08:07 2023 ------##
##------ Tue Mar 14 13:08:17 2023 ------##
##------ Tue Mar 14 13:08:17 2023 ------##
##------ Tue Mar 14 13:08:17 2023 ------##
##------ Tue Mar 14 13:08:18 2023 ------##
##------ Tue Mar 14 13:10:39 2023 ------##
##------ Tue Mar 14 13:10:41 2023 ------##
##------ Tue Mar 14 13:10:46 2023 ------##
names(Pagwas)
print(Pagwas)
names(Pagwas@meta.data)
names(Pagwas@misc)
names(Pagwas@RNA)
names(Pagwas@assays)
library(scPagwas)
Pagwas_celltypes<-scPagwas_main(Pagwas =NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=F,
celltype=T,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
##------ Tue Mar 14 14:04:20 2023 ------##
##------ Tue Mar 14 14:04:24 2023 ------##
##------ Tue Mar 14 14:04:32 2023 ------##
##------ Tue Mar 14 14:04:33 2023 ------##
##------ Tue Mar 14 14:04:33 2023 ------##
##------ Tue Mar 14 14:04:34 2023 ------##
##------ Tue Mar 14 14:05:22 2023 ------##
Pagwas_celltypes
names(Pagwas_celltypes)
Pagwas_singlecell<-scPagwas_main(Pagwas =Pagwas_celltypes,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=F
block_annotation = block_annotation,
Pagwas_singlecell<-scPagwas_main(Pagwas =Pagwas_celltypes,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
Single_data =system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
output.prefix="Test",
output.dirs="Test",
Pathway_list=Genes_by_pathway_kegg,
assay="RNA",
singlecell=T,
celltype=F,
block_annotation = block_annotation,
chrom_ld = chrom_ld)
##------ Tue Mar 14 14:06:38 2023 ------##
##------ Tue Mar 14 14:06:42 2023 ------##
##------ Tue Mar 14 14:06:43 2023 ------##
##------ Tue Mar 14 14:06:43 2023 ------##
##------ Tue Mar 14 14:06:44 2023 ------##
##------ Tue Mar 14 14:09:02 2023 ------##
##------ Tue Mar 14 14:09:07 2023 ------##
Pagwas_singlecell
suppressMessages(require("RColorBrewer"))
suppressMessages(require("Seurat"))
suppressMessages(require("SeuratObject"))
suppressMessages(require("ggsci"))
suppressMessages(require("dplyr"))
suppressMessages(require("ggplot2"))
suppressMessages(require("ggpubr"))
Seurat::DimPlot(Pagwas,pt.size=1,reduction="umap",label = T, repel=TRUE)+
umap_theme()+ggtitle("Test")+labs(x="UMAP",y="")+theme(aspect.ratio=1)
scPagwas_Visualization(Single_data=Pagwas_singlecell,
p_thre = 0.05,
FigureType = "umap",
width = 7,
height = 7,
lowColor = "white",
highColor = "red",
output.dirs="figure",
size = 0.5,
do_plot = T)
plot_bar_positie_nagtive(seurat_obj=Pagwas_singlecell,
var_ident="anno",
var_group="positiveCells",
vec_group_colors=c("#E8D0B3","#7EB5A6"),
do_plot = T)
plot_bar_positie_nagtive(seurat_obj=Pagwas_singlecell,
var_ident="positiveCells",
var_group="anno",
p_thre = 0.01,
vec_group_colors=NULL,
f_color=colorRampPalette(brewer.pal(n=10, name="RdYlBu")),
do_plot = T)
suppressMessages(library(tidyverse))
suppressMessages(library(rhdf5))
suppressMessages(library(ggplot2))
suppressMessages(library(grDevices))
suppressMessages(library(stats))
suppressMessages(library(FactoMineR))
suppressMessages(library(scales))
suppressMessages(library(reshape2))
suppressMessages(library(ggdendro))
suppressMessages(library(grImport2))
suppressMessages(library(gridExtra))
suppressMessages(library(grid))
suppressMessages(library(sisal))
source(system.file("extdata", "plot_scpathway_contri_dot.R", package = "scPagwas"))
plot_scpathway_dot(Pagwas=Pagwas_singlecell,
celltypes=unique(Idents(Pagwas_singlecell)),
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="logrankPvalue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "logrankPvalue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
#figurenames = "Pathway_plot.pdf",
width = 7,
height = 7)
plot_scpathway_dot(Pagwas=Pagwas_singlecell,
celltypes=unique(Idents(Pagwas_singlecell)),
topn_path_celltype=5,
filter_p=0.05,
max_logp=15,
display_max_sizes=F,
size_var ="CellpValue" ,
col_var="proportion",
shape.scale = 8,
cols.use=c("lightgrey", "#E45826"),
dend_x_var = "CellpValue",
dist_method="euclidean",
hclust_method="ward.D",
do_plot = T,
#figurenames = "Pathway_plot.pdf",
width = 7,
height = 7)
Pagwas_singlecell
Pagwas=Pagwas_singlecell;
celltypes=unique(Idents(Pagwas_singlecell));
topn_path_celltype=5;
filter_p=0.05;
max_logp=15;
display_max_sizes=F;
size_var ="CellpValue";
col_var="proportion";
shape.scale = 8;
cols.use=c("lightgrey", "#E45826");
dend_x_var = "CellpValue";
dist_method="euclidean";
hclust_method="ward.D";
do_plot = T;
#figurenames = "Pathway_plot.pdf",
width = 7;
height = 7
paras_sum_mean <- NULL
############### proportion
proportion_list <- tapply(
as.vector(Idents(Pagwas)),
Idents(Pagwas), function(x) {
scPagwasPaHeritability <- t(GetAssayData(Pagwas,
assay = "scPagwasPaHeritability"))
a <- apply(scPagwasPaHeritability, 2,
function(y) sum(y > 0) / length(y))
return(unlist(a))
}
)
proportion_df <- Reduce(function(dtf1, dtf2) cbind(dtf1, dtf2),
proportion_list)
colnames(proportion_df) <- names(proportion_list)
proportion_df
scPathrankP <- -log10(Pagwas@misc$scPathways_rankPvalue + 1e-20)
scPathrankP
heritability_cor_scatterplot(gene_heri_cor=Pagwas_singlecell@misc$gene_heritability_correlation,
topn_genes_label=10,
color_low="#035397",
color_high ="#F32424",
color_mid = "white",
text_size=2,
do_plot=T,
max.overlaps =20,
width = 7,
height = 7)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[1:5]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
Bootstrap_P_Barplot(p_results=Pagwas_singlecell@misc$bootstrap_results$bp_value[-1],
p_names=rownames(Pagwas_singlecell@misc$bootstrap_results)[-1],
width = 5,
height = 7,
do_plot=T,
title = "Test")
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[1:3]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[4]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[4,7,8]]
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,7,8)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4:10)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,11:16)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,17:23)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,24:30)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,30,31:36)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,30,36,37:43)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,30,36,44:50)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,30,36,51:55)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
suppressMessages(library("ggsci"))
suppressMessages(library("Seurat"))
top5genes<-rownames(Pagwas_singlecell@misc$gene_heritability_correlation)[order(Pagwas_singlecell@misc$gene_heritability_correlation,decreasing = T)[c(4,30,36,55)]]
plot_vln_Corgenes(seurat_obj=Pagwas_singlecell,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
do_plot = T
)
Bootstrap_estimate_Plot(Pagwas=Pagwas_singlecell,
width = 9,
height = 7,
do_plot=T)
